"use strict";(self.webpackChunktalk_call_chat_frontend=self.webpackChunktalk_call_chat_frontend||[]).push([[883],{67883:(e,t,s)=>{s.r(t),s.d(t,{default:()=>R});var n=s(65043),o=s(55978),r=s(70579);const a=()=>(0,r.jsx)("img",{src:"assets/logo.png",alt:"logo",className:"w-1/3"});var l=s(20870),i=s(3180),c=s(73216);const d=()=>{const e=(0,c.Zp)(),t=((0,n.useRef)(null),(0,n.useContext)(i.cy)),s=(0,n.useContext)(l.r),[a,d]=(0,n.useState)(null),[h,x]=(0,n.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer ml-auto flex-shrink-0",children:[(0,r.jsx)("div",{onClick:()=>s.colorMode.setTheme(0===s.colorMode.theme?1:0),className:"w-[22px] h-[22px] text-[var(--settings-icon-color)] flex-shrink-0 hover:text-gray-400",children:0===s.colorMode.theme?(0,r.jsx)("svg",{className:"w-full fill-transparent transition-all duration-500",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,r.jsx)("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"})}):(0,r.jsxs)("svg",{className:"w-full fill-transparent transition-all duration-500",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"5"}),(0,r.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,r.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,r.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,r.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,r.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,r.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),(0,r.jsx)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),(0,r.jsx)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),(0,r.jsx)("div",{onClick:()=>{x(!h)},className:"text-[var(--settings-icon-color)] w-[22px] h-[22px] flex-shrink-0 hover:text-gray-400",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,r.jsx)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})}),(0,r.jsx)("img",{className:"w-[40px] h-[40px] rounded-full border border-slate-300",src:"assets/avatar-default.svg",alt:"account-profile"})]}),h&&(0,r.jsx)("div",{className:"absolute top-16 right-5",children:(0,r.jsxs)(o.iK,{type:"slidedown",children:[1===t.user.role&&(0,r.jsx)("div",{className:"shadow-xl w-[200px] bg-white rounded-lg border border-slate-300",children:(0,r.jsxs)("div",{onClick:()=>e("/admin"),className:"cursor-pointer flex items-center justify-between hover:bg-neutral-200 px-4 py-2",children:[(0,r.jsx)("p",{className:"font-semibold text-[14px] ",children:"\u0410\u0434\u043c\u0438\u043d\u043a\u0430"}),(0,r.jsx)(o.In,{image:"command",color:"green"})]})}),(0,r.jsx)("div",{className:"shadow-xl w-[200px] bg-white rounded-lg border border-slate-300",children:(0,r.jsxs)("div",{onClick:()=>t.auth.signout(),className:"cursor-pointer flex items-center justify-between hover:bg-gray-300 px-4 py-2",children:[(0,r.jsx)("p",{className:"font-semibold text-[14px] ",children:"\u0412\u044b\u0445\u043e\u0434"}),(0,r.jsx)(o.In,{image:"log-out",color:"red"})]})})]})})]})},h=e=>{let{search:t,setSearch:s,setCurrentPage:n}=e;return(0,r.jsxs)("section",{className:"h-[12vh] border-b border-slate-300 flex sm:flex-row",children:[(0,r.jsx)("div",{className:"w-[15%] sm:w-1/4 overflow-hidden flex items-center px-4 border-r",children:(0,r.jsx)(a,{})}),(0,r.jsx)("div",{className:"w-[50%] sm:w-1/2 overflow-hidden flex items-center",children:(0,r.jsx)(o.DO,{value:t,onChange:e=>(e=>{n(1),s(e)})(e)})}),(0,r.jsx)("div",{className:"w-[35%] sm:w-1/4 overflow-hidden flex items-center justify-end px-4 border-l",children:(0,r.jsx)(d,{})})]})};var x=s(86213);const u=e=>{let{type:t,setType:s,setCurrentPage:o,setConversations:a}=e;const i=(0,n.useContext)(l.r),c=e=>{o(1),t!==e&&a([]),s(e)};return(0,r.jsxs)("div",{className:"w-full min-h-[6vh] flex items-center select-none border-b border-slate-300",children:[(0,r.jsx)("div",{onClick:()=>c(!1),className:"\n          h-full w-1/2 flex items-center\n          justify-center cursor-pointer border-r border-slate-300\n          ".concat(!1===t&&0===i.colorMode.theme&&"bg-gray-300","\n          ").concat(!1===t&&1===i.colorMode.theme&&"bg-[#404d69]","\n        "),children:(0,r.jsx)("p",{className:"\n            font-semibold text-[13px]\n            ".concat(0===i.colorMode.theme?"text-black":"text-white","\n          "),children:"\u0412\u0441\u0435"})}),(0,r.jsx)("div",{onClick:()=>c(!0),className:"\n          h-full w-1/2 flex items-center\n          justify-center cursor-pointer\n          ".concat(!0===t&&0===i.colorMode.theme&&"bg-gray-300","\n          ").concat(!0===t&&1===i.colorMode.theme&&"bg-[#404d69]","\n        "),children:(0,r.jsx)("p",{className:"\n            font-semibold text-[13px]\n            ".concat(0===i.colorMode.theme?"text-black":"text-white","\n          "),children:"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u044b\u0435"})})]})};var m=s(24033);const v=e=>{const{conversations:t,activeConversation:s,handleChatClick:o,setConversations:a,setCurrentPage:i,currentPage:c}=e,d=(0,n.useRef)(null),h=(0,n.useContext)(l.r),{raiseConversation:x}=(0,m.c)();(0,n.useEffect)((()=>{const e=()=>{if(d.current){const{scrollHeight:e,scrollTop:t,clientHeight:s}=d.current;t+s+1>=e&&i((e=>e+1))}},t=d.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}}),[c]),(0,n.useEffect)((()=>{x&&u()}),[x]);const u=()=>{a((e=>{const t=e.findIndex((e=>e.customer_id===x.customer_id));if(-1!==t){const s=e[t];return s.counter=(s.counter||0)+(x.counter||0),e.splice(t,1),[s,...e]}return[{...x,counter:x.counter||0},...e]}))};return(0,r.jsx)("div",{ref:d,className:"flex-grow overflow-y-auto",children:t.length>0&&t.map(((e,t)=>{var n;return(0,r.jsxs)("div",{onClick:()=>o(e),className:"relative select-none\n            cursor-pointer flex items-center gap-2 px-5 py-3\n            ".concat(0===h.colorMode.theme&&"hover:bg-gray-300","\n            ").concat(1===h.colorMode.theme&&"hover:bg-[#2d3f65]","\n            ").concat(s.customer_id===e.customer_id&&0===h.colorMode.theme&&"bg-gray-300","\n            ").concat(s.customer_id===e.customer_id&&1===h.colorMode.theme&&"bg-[#2d3f65]","\n          "),children:[s.customer_id===e.customer_id&&(0,r.jsx)("div",{className:"absolute left-0 h-full w-1 bg-[#0086FF]"}),(0,r.jsx)("div",{className:"relative inline-block",children:(0,r.jsx)("img",{src:null!==(n=e.avatar)&&void 0!==n?n:"assets/avatar-default.svg",className:"border border-slate-300 rounded-full w-10 h-10"})}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("p",{className:"font-semibold text-[15px] ".concat(0===h.colorMode.theme?"text-black":"text-white"),children:e.name}),(0,r.jsxs)("div",{className:"flex items-center overflow-hidden gap-1",children:[(0,r.jsx)("p",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis text-[var(--msg-message)] text-[13px]",children:e.phone}),(0,r.jsxs)("p",{className:"text-[14px] text-[var(--msg-date)] ml-3 relative",children:[(0,r.jsx)("span",{className:"absolute top-0 left-[-10px]",children:"\u2022"}),e.lastMessageTime]})]}),(null===e||void 0===e?void 0:e.counter)&&(0,r.jsx)("div",{className:"absolute top-2 right-2 overflow-hidden",children:(0,r.jsx)("p",{className:"flex items-center justify-center text-[12px] w-5 h-5 bg-red-500 rounded-full text-white",children:(null===e||void 0===e?void 0:e.counter)>100?"99+":null===e||void 0===e?void 0:e.counter})})]})]},e.customer_id)}))})},g=e=>{let{setConversations:t}=e;const s=(0,n.useContext)(i.cy),o=(0,n.useContext)(l.r),[a,c]=(0,n.useState)(""),[d,h]=(0,n.useState)(null);return(0,r.jsxs)("div",{className:"flex flex-col gap-6 h-[25vh]",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("p",{className:"w-32 font-semibold text-lg",children:"LeadVertext_Id:"}),(0,r.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",className:"pl-[16px] outline-none h-8 w-full \n            bg-transparent text-body-color bg-no-repeat \n            bg-[length:16px] bg-[25px_48%] font-body-font \n            font-semibold text-[15px] placeholder-input-chat-color\n            border border-slate-300 rounded-lg\n            ".concat(0===o.colorMode.theme?"text-black":"text-white","\n          ")})]}),(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("p",{className:"w-32 font-semibold text-lg",children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435:"}),(0,r.jsx)("input",{type:"text",value:a,onChange:e=>c(e.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",className:"pl-[16px] outline-none h-8 w-full \n            bg-transparent text-body-color bg-no-repeat \n            bg-[length:16px] bg-[25px_48%] font-body-font \n            font-semibold text-[15px] placeholder-input-chat-color\n            border border-slate-300 rounded-lg\n            ".concat(0===o.colorMode.theme?"text-black":"text-white","\n          ")})]}),(0,r.jsx)("button",{onClick:async()=>{a&&d?await(0,x.A)({method:"POST",url:"v1/send_first_message",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.user.token)},data:{message:a,leadvertex_id:d,sender:s.user.manager_name}}).then((e=>{t((t=>[e.data.new_customer,...t])),o.modal.hide(),o.notification.show("\u0423\u0441\u043f\u0435\u0448\u043d\u043e!","success")})).catch((e=>o.notification.show(e.response.data.detail,"error"))):o.notification.show("\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f","error")},className:"ml-auto max-w-[20vh] mt-4 bg-white p-2 \n          rounded-lg hover:bg-blue-100 border border-slate-300\n        ",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})},p=e=>{let{setConversations:t}=e;const s=(0,n.useContext)(l.r);return(0,r.jsx)("div",{onClick:()=>{s.modal.show({title:"\u041d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u043c",children:(0,r.jsx)(g,{setConversations:t})})},className:"fixed bottom-3 left-3 bg-[#0086FF] w-8 h-8 rounded-full flex items-center justify-center cursor-pointer shadow-xl",children:(0,r.jsx)(o.In,{image:"plus",color:"white",size:28})})},f=e=>{const{activeConversation:t,setActiveConversation:s,type:n,setType:o,conversations:a,setConversations:l,fetchConversation:i,setCurrentPage:c,currentPage:d,setFile:h}=e,{raisedConversations:x,setRaisedConversations:g}=(0,m.c)();return(0,r.jsxs)("div",{className:"flex flex-col h-full w-full sm:w-1/4 overflow-y-auto border-r border-slate-300 relative",children:[(0,r.jsx)(u,{type:n,setType:o,setCurrentPage:c,setConversations:l}),(0,r.jsx)(v,{conversations:a,activeConversation:t,handleChatClick:e=>{s(e),i(e.id),h(null)},setConversations:l,currentPage:d,setCurrentPage:c}),(0,r.jsx)(p,{setConversations:l})]})},j=e=>{let{fetchConversations:t,isFavorite:s,title:o,activeConversation:a,setConversations:c,setCurrentPage:d,setActiveConversation:h}=e;(0,n.useContext)(i.cy);const u=(0,n.useContext)(l.r);return(0,r.jsxs)("div",{className:"flex items-center justify-between px-6 py-6 border-b border-slate-300",children:[(0,r.jsx)("div",{className:"text-[18px] font-semibold ".concat(0===u.colorMode.theme?"text-black":"text-white"),children:o}),(0,r.jsx)("div",{onClick:()=>(async()=>{await(0,x.A)({method:"PATCH",url:"/conversations/".concat(a.customer_id),data:{isFavorite:a.isFavorite}}).then((()=>{c([]),d(1),t(),h({customer_id:null,customer_good:"",customer_phone:"",leadvertex_id:null})})).catch((e=>u.notification.show(e.response.data.detail,"error")))})(),children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"".concat(s?"red":"none"),stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:(0,r.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})})]})},w=e=>{var t,s;const{message:a,openGoogleMaps:l}=e,[i,c]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:"\n        relative flex items-end gap-2\n        ".concat(a.incoming?"flex-row":"flex-row-reverse","\n      "),children:[i&&(0,r.jsx)("div",{className:"absolute top-[-100px] left-0 right-0 z-10 bg-black border text-white p-3",children:(0,r.jsx)("p",{children:"Quoted Message"})}),(0,r.jsx)("img",{src:null!==(t=a.avatar)&&void 0!==t?t:"assets/avatar-default.svg",alt:"avatar",className:"h-10 w-10 rounded-full border border-slate-300"}),(0,r.jsxs)("div",{className:"\n          inline-block min-w-[10px] max-w-[50%]\n          ".concat(a.incoming&&!a.attachment_url&&"rounded-r-xl rounded-tl-xl bg-gray-200 text-black px-3 py-3","\n          ").concat(!a.incoming&&!a.attachment_url&&"rounded-l-xl rounded-tr-xl bg-[#0086FF] text-white px-3 py-3","\n        "),children:[(0,r.jsx)("p",{children:null===a||void 0===a?void 0:a.text}),null===a||void 0===a||null===(s=a.attachments)||void 0===s?void 0:s.map((e=>(0,r.jsxs)(n.Fragment,{children:["image/jpeg"===e.contentType&&(0,r.jsx)("img",{src:e.link,alt:e.link,className:"w-fit min-h-16 max-h-40 rounded-lg"}),"application/pdf"===e.contentType&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("img",{className:"w-8 h-8",src:"assets/doc.png"}),(0,r.jsx)("a",{href:e.link,alt:a.url,target:"_blank",className:"hover:text-blue-500",children:"\u0421\u043a\u0430\u0447\u0430\u0442\u044c"})]}),"audio/ogg; codecs=opus"===e.contentType||"audio/ogg"===e.contentType&&(0,r.jsx)(o.$G,{src:e.link}),"locationMessage"===e.contentType&&(0,r.jsx)("img",{src:"data:image/jpeg;base64,".concat(e.thumb),alt:e.link,onClick:()=>l(e.lat,e.lon),className:"rounded-lg cursor-pointer"}),"video/mp4"===e.contentType&&(0,r.jsx)("video",{src:e.link,alt:e.link,className:"rounded-lg cursor-pointer",controls:!0})]},e.id)))]})]})},b=e=>{let{conversation:t,setConversation:s,activeConversation:o}=e;const a=(0,n.useRef)(null),{newMessage:l}=(0,m.c)();(0,n.useEffect)((()=>{c()}),[t]),(0,n.useEffect)((()=>{l&&i(l)}),[l]);const i=e=>{if(o.customer_phone===e.chat_phone){const n=[...t];n.push(e),s(n)}},c=()=>{a.current&&a.current.scrollIntoView({behavior:"smooth"})},d=(e,t)=>{const s="https://www.google.com/maps?q=".concat(e,",").concat(t,"&z=15&output=embed");window.open(s,"_blank")};return(0,r.jsxs)("div",{className:"w-full h-full flex flex-col gap-3 overflow-y-auto px-6 py-6",children:[(null===t||void 0===t?void 0:t.length)>0&&(null===t||void 0===t?void 0:t.map((e=>(0,r.jsx)(n.Fragment,{children:(0,r.jsx)(w,{message:e,openGoogleMaps:d})},e.id)))),(0,r.jsx)("div",{ref:a})]})};var y=s(51842),C=s(70410);const k=e=>{const{fileInputRef:t,handleFileChange:s,file:o,setFile:a,message:i,setMessage:c,handleSendMessage:d,startRecording:h,isMessageSending:x}=e,u=(0,n.useContext)(l.r),[m,v]=(0,n.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"w-[5%] flex items-center justify-center pl-3 gap-2 py-6",children:[(0,r.jsx)("div",{onClick:()=>t.current.click(),children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:(0,r.jsx)("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"})})}),(0,r.jsx)("input",{type:"file",ref:t,style:{display:"none"},onChange:s})]}),(0,r.jsxs)("div",{className:"w-[85%] relative flex items-center h-full",children:[o&&(0,r.jsx)("div",{className:"absolute top-0",children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("p",{className:"\n                text-[10px]\n                ".concat(0===u.colorMode.theme?"text-black":"text-white","\n              "),children:o.name}),(0,r.jsx)("svg",{viewBox:"0 0 1024 1024",fill:"currentColor",height:"0.7em",width:"0.7em",cursor:"pointer",onClick:()=>a(null),children:(0,r.jsx)("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})})]})}),(0,r.jsx)("input",{type:"text",className:"w-full outline-none h-10 rounded-md pl-3 border border-slate-300",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",value:i,onChange:e=>{e.preventDefault(),c(e.target.value)},onKeyDown:e=>{x||"Enter"!==e.key||d()},disabled:!!o}),(0,r.jsx)("div",{className:"absolute right-0 pr-3",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",onClick:()=>{x||d()},children:[(0,r.jsx)("path",{d:"M22 2L11 13"}),(0,r.jsx)("path",{d:"M22 2L15 22 11 13 2 9l20-7z"})]})})]}),(0,r.jsxs)("div",{className:"w-[10%] flex items-center gap-2 py-6",children:[(0,r.jsx)("div",{onClick:()=>h(),children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:[(0,r.jsx)("path",{d:"M12 1a3 3 0 0 1 3 3v10a3 3 0 0 1-6 0V4a3 3 0 0 1 3-3z"}),(0,r.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,r.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,r.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,r.jsx)("div",{onClick:()=>v(!m),children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:[(0,r.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,r.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01"})]})})]}),m&&(0,r.jsx)("div",{className:"absolute bottom-0 sm:bottom-20 sm:right-20",children:(0,r.jsx)(y.A,{data:C,previewPosition:"none",onEmojiSelect:e=>{c(i+e.native),v(!m)}})})]})},N=e=>{const{handleDeleteRecord:t,audio:s,handleReloadRecord:o,handleSendMessage:a,isMessageSending:i}=e,c=(0,n.useContext)(l.r);return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3 w-full h-full",children:[(0,r.jsx)("div",{className:"w-[5%] flex items-center justify-center pl-3 py-6",children:(0,r.jsx)("div",{onClick:()=>t(),className:"hover:bg-gray-200 rounded-md",children:(0,r.jsx)("svg",{fill:"red",viewBox:"0 0 16 16",height:"1.2em",width:"1.2em",cursor:"pointer",children:(0,r.jsx)("path",{d:"M6.5 1h3a.5.5 0 01.5.5v1H6v-1a.5.5 0 01.5-.5zM11 2.5v-1A1.5 1.5 0 009.5 0h-3A1.5 1.5 0 005 1.5v1H2.506a.58.58 0 00-.01 0H1.5a.5.5 0 000 1h.538l.853 10.66A2 2 0 004.885 16h6.23a2 2 0 001.994-1.84l.853-10.66h.538a.5.5 0 000-1h-.995a.59.59 0 00-.01 0H11zm1.958 1l-.846 10.58a1 1 0 01-.997.92h-6.23a1 1 0 01-.997-.92L3.042 3.5h9.916zm-7.487 1a.5.5 0 01.528.47l.5 8.5a.5.5 0 01-.998.06L5 5.03a.5.5 0 01.47-.53zm5.058 0a.5.5 0 01.47.53l-.5 8.5a.5.5 0 11-.998-.06l.5-8.5a.5.5 0 01.528-.47zM8 4.5a.5.5 0 01.5.5v8.5a.5.5 0 01-1 0V5a.5.5 0 01.5-.5z"})})})}),(0,r.jsx)("div",{className:"w-[85%] flex items-center h-full",children:s&&(0,r.jsx)("audio",{controls:!0,src:s,className:"w-full"})}),(0,r.jsxs)("div",{className:"w-[10%] flex items-center gap-2 py-6",children:[(0,r.jsx)("div",{onClick:()=>o(),className:"w-5 h-5 cursor-pointer hover:bg-gray-200 hover:rounded-md hover:font-bold",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:0===c.colorMode.theme?"black":"white",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M12 1a3 3 0 0 1 3 3v10a3 3 0 0 1-6 0V4a3 3 0 0 1 3-3z"}),(0,r.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,r.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,r.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,r.jsx)("div",{onClick:()=>{i||a()},className:"w-5 h-5 cursor-pointer hover:bg-gray-200 hover:rounded-md hover:font-bold",children:(0,r.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:0===c.colorMode.theme?"black":"white",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,r.jsx)("path",{d:"M22 2L11 13"}),(0,r.jsx)("path",{d:"M22 2L15 22 11 13 2 9l20-7z"})]})})]})]})},M=e=>{const{handleDeleteRecord:t,volume:s,stopRecording:o}=e,a=(0,n.useContext)(l.r);return(0,r.jsxs)("div",{className:"flex items-center justify-center gap-3 w-full",children:[(0,r.jsx)("div",{className:"w-[5%] flex items-center justify-center pl-3 py-6",children:(0,r.jsx)("div",{onClick:()=>t(),className:"hover:bg-gray-200 rounded-md",children:(0,r.jsx)("svg",{fill:"red",viewBox:"0 0 16 16",height:"1.2em",width:"1.2em",cursor:"pointer",children:(0,r.jsx)("path",{d:"M6.5 1h3a.5.5 0 01.5.5v1H6v-1a.5.5 0 01.5-.5zM11 2.5v-1A1.5 1.5 0 009.5 0h-3A1.5 1.5 0 005 1.5v1H2.506a.58.58 0 00-.01 0H1.5a.5.5 0 000 1h.538l.853 10.66A2 2 0 004.885 16h6.23a2 2 0 001.994-1.84l.853-10.66h.538a.5.5 0 000-1h-.995a.59.59 0 00-.01 0H11zm1.958 1l-.846 10.58a1 1 0 01-.997.92h-6.23a1 1 0 01-.997-.92L3.042 3.5h9.916zm-7.487 1a.5.5 0 01.528.47l.5 8.5a.5.5 0 01-.998.06L5 5.03a.5.5 0 01.47-.53zm5.058 0a.5.5 0 01.47.53l-.5 8.5a.5.5 0 11-.998-.06l.5-8.5a.5.5 0 01.528-.47zM8 4.5a.5.5 0 01.5.5v8.5a.5.5 0 01-1 0V5a.5.5 0 01.5-.5z"})})})}),(0,r.jsx)("div",{className:"w-[85%] relative flex items-center h-full",children:(0,r.jsx)("div",{style:{width:"100%",height:"10px",background:"gray",position:"relative",overflow:"hidden"},children:(0,r.jsx)("div",{style:{width:"".concat(s,"%"),height:"100%",background:"red",position:"absolute",left:0,transition:"width 0.1s"}})})}),(0,r.jsx)("div",{className:"w-[10%] flex items-center justify-center py-6",children:(0,r.jsx)("div",{onClick:()=>o(),className:"hover:bg-gray-200 rounded-md",children:(0,r.jsx)("svg",{viewBox:"0 0 1024 1024",fill:0===a.colorMode.theme?"black":"white",height:"1.4em",width:"1.4em",cursor:"pointer",children:(0,r.jsx)("path",{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"})})})})]})},_=e=>{let{file:t,setFile:s,message:o,setMessage:a,audio:l,setAudio:i,setRAudio:c,handleSendMessage:d,isMessageSending:h}=e;const x=(0,n.useRef)(null),u=(0,n.useRef)([]),m=(0,n.useRef)(null),v=(0,n.useRef)(null),g=(0,n.useRef)(null),p=(0,n.useRef)(null),f=(0,n.useRef)(null),[j,w]=(0,n.useState)("default"),[b,y]=(0,n.useState)(0),C=()=>{s(null),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{const t=new(window.AudioContext||window.webkitAudioContext);m.current=t;const s=t.createMediaStreamSource(e),n=t.createAnalyser();n.fftSize=256,g.current=n;const o=n.frequencyBinCount,r=new Uint8Array(o);v.current=r,s.connect(n);const a=new MediaRecorder(e,{mimeType:"audio/ogg; codecs=opus"});p.current=a,a.start(),a.ondataavailable=e=>{u.current.push(e.data)},a.onstop=async()=>{const e=new Blob(u.current,{type:"audio/ogg; codecs=opus"}),s=URL.createObjectURL(e),n=new File([e],"recording.ogg",{type:"audio/ogg; codecs=opus"});i(s),c(n),u.current=[],t.close(),cancelAnimationFrame(f.current)},w("recording"),S()})).catch((e=>{console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0438\u0441\u0438 \u0430\u0443\u0434\u0438\u043e:",e)}))},_=()=>{w("default")},S=()=>{if(g.current&&v.current){g.current.getByteFrequencyData(v.current);const e=Math.max(...v.current);y(e),f.current=requestAnimationFrame(S)}};return(0,r.jsxs)("div",{className:"flex items-center gap-2 border-t border-slate-300",children:["default"===j&&(0,r.jsx)(k,{fileInputRef:x,handleFileChange:e=>{i(null),c(null);const t=e.target.files[0];a(""),t&&s(t)},file:t,setFile:s,message:o,setMessage:a,handleSendMessage:d,startRecording:C,isMessageSending:h}),"recording"===j&&(0,r.jsx)(M,{volume:b,stopRecording:()=>{p.current&&(p.current.stop(),w("reload"))},handleDeleteRecord:_}),"reload"===j&&(0,r.jsx)(N,{handleDeleteRecord:_,audio:l,handleReloadRecord:()=>{i(null),c(null),C(),w("recording")},handleSendMessage:d,isMessageSending:h})]})},S=e=>{let{conversation:t,setConversation:s,fetchConversations:o,activeConversation:a,setActiveConversation:i,message:c,setMessage:d,file:h,setFile:x,handleSendMessage:u,setConversations:m,setCurrentPage:v,audio:g,setAudio:p,rAudio:f,setRAudio:w,isMessageSending:y}=e;const C=(0,n.useContext)(l.r);return(0,r.jsx)("div",{className:"flex flex-col justify-between sm:w-1/2 overflow-y-auto",children:a.customer_id?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j,{isFavorite:a.isFavorite,activeConversation:a,setActiveConversation:i,title:a.customer_good,fetchConversations:o,setConversations:m,setCurrentPage:v}),(0,r.jsx)(b,{conversation:t,setConversation:s,activeConversation:a}),(0,r.jsx)(_,{file:h,setFile:x,message:c,setMessage:d,handleSendMessage:u,audio:g,setAudio:p,rAudio:f,setRAudio:w,isMessageSending:y})]}):(0,r.jsxs)("div",{className:"h-full flex flex-col items-center justify-center pb-10",children:[(0,r.jsx)("p",{className:"\n              font-bold text-2xl\n              ".concat(0===C.colorMode.theme&&"text-black","\n              ").concat(1===C.colorMode.theme&&"text-white","\n            "),children:"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430 \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0447\u0430\u0442"}),(0,r.jsx)("img",{src:"assets/to_left.png",className:"w-1/2"})]})})},A=e=>{var t;let{activeConversation:s,message:o,setMessage:a}=e;const i=(0,n.useContext)(l.r);return(0,r.jsx)("div",{className:"h-full w-full sm:w-1/4 border-l border-slate-300 overflow-y-auto",children:s.customer_id?(0,r.jsxs)("div",{className:"flex flex-col gap-6 items-center py-6",children:[(0,r.jsx)("img",{src:null!==(t=s.customer_photo)&&void 0!==t?t:"assets/avatar-default.svg",className:"h-16 w-16 rounded-full border border-slate-300"}),(0,r.jsxs)("div",{className:"flex flex-col gap-2 items-start border-t border-b w-full px-2 py-4",children:[(0,r.jsx)("p",{className:"\n                text-2xl font-bold \n                ".concat(0===i.colorMode.theme&&"text-black","\n                ").concat(1===i.colorMode.theme&&"text-white","\n              "),children:"\u0428\u0430\u0431\u043b\u043e\u043d\u044b"}),(0,r.jsx)("p",{className:"\n                text-md cursor-pointer hover:text-gray-300 \n                ".concat(0===i.colorMode.theme&&"text-black","\n                ").concat(1===i.colorMode.theme&&"text-white","\n              "),onClick:()=>a("\u0421\u04d9\u043b\u0435\u043c\u0435\u0442\u0441\u0456\u0437\u0431\u0435"),children:"1. \u0421\u04d9\u043b\u0435\u043c\u0435\u0442\u0441\u0456\u0437\u0431\u0435"}),(0,r.jsx)("p",{className:"\n                text-md cursor-pointer hover:text-gray-300 \n                ".concat(0===i.colorMode.theme&&"text-black","\n                ").concat(1===i.colorMode.theme&&"text-white","\n              "),onClick:()=>a("\u0416\u0430\u049b\u0441\u044b \u0440\u0430\u0445\u043c\u0435\u0442"),children:"2. \u0416\u0430\u049b\u0441\u044b \u0440\u0430\u0445\u043c\u0435\u0442"}),(0,r.jsx)("p",{className:"\n                text-md cursor-pointer hover:text-gray-300 \n                ".concat(0===i.colorMode.theme&&"text-black","\n                ").concat(1===i.colorMode.theme&&"text-white","\n              "),onClick:()=>a("\u0416\u043e\u049b"),children:"3. \u0416\u043e\u049b"})]})]}):(0,r.jsx)("div",{className:"h-full flex flex-col items-center justify-center",children:(0,r.jsx)("img",{src:"assets/select_emoji.png"})})})},L=e=>{let{search:t,currentPage:s,setCurrentPage:o}=e;(0,n.useContext)(i.cy);const a=(0,n.useContext)(l.r),[c,d]=(0,n.useState)({customer_id:null,customer_good:"",customer_phone:"",leadvertex_id:null}),[h,u]=(0,n.useState)([]),[m,v]=(0,n.useState)(!1),[g,p]=(0,n.useState)([]),[j,w]=(0,n.useState)(""),[b,y]=(0,n.useState)(!1),[C,k]=(0,n.useState)(null),[N,M]=(0,n.useState)(null),[_,L]=(0,n.useState)(null),[R,F]=(0,n.useState)(null);(0,n.useEffect)((()=>{z()}),[t,m,s]);const z=async()=>{const e={limit:20,page:s,type:m};""!==t&&(e.search=t),await(0,x.A)({method:"GET",url:"/conversations",params:{...e}}).then((e=>{p(""!==t?[...e.data.conversations]:t=>[...t,...e.data.conversations])})).catch((e=>{a.notification.show(e.response.data.detail,"error")}))},P=()=>(console.log(j.length),null!==C||0!==j.length||null!==_||(a.notification.show("\u041f\u0443\u0441\u0442\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","error"),!1));return(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row h-[88vh]",children:[(0,r.jsx)(f,{setCurrentPage:o,fetchConversation:async e=>{await(0,x.A)({method:"GET",url:"/messages/".concat(e)}).then((e=>u(e.data.messages))).catch((e=>a.notification.show(e.response.data.detail,"error")))},type:m,setType:v,conversations:g,setConversations:p,activeConversation:c,setActiveConversation:d,setFile:k}),(0,r.jsx)(S,{setConversations:p,setCurrentPage:o,conversation:h,setConversation:u,fetchConversations:z,activeConversation:c,setActiveConversation:d,message:j,setMessage:w,file:C,setFile:k,handleSendMessage:async e=>{if(!P())return;y(!0);const t=new FormData;t.append("customer_id",c.customer_id),j&&(t.append("message",j),t.append("type","textMessage")),_&&(t.append("files",_),t.append("type","fileMessage")),C&&(t.append("files",C),t.append("type","fileMessage")),R&&(t.append("location",R),t.append("type","locationMessage")),await(0,x.A)({method:"POST",url:"/messages/".concat(c.id),headers:{"Content-Type":"multipart/form-data"},data:t}).then((e=>{const t=[...h];t.push(e.data.message),u(t),w(""),k(null),y(!1)})).catch((e=>{a.notification.show(e.response.data.detail,"error")}))},audio:N,setAudio:M,rAudio:_,setRAudio:L,isMessageSending:b}),(0,r.jsx)(A,{activeConversation:c,message:j,setMessage:w})]})};function R(){const[e,t]=(0,n.useState)(""),[s,o]=(0,n.useState)(1);return(0,r.jsxs)("div",{className:"flex flex-col w-full min-h-[100vh]",children:[(0,r.jsx)(h,{search:e,setSearch:t,setCurrentPage:o}),(0,r.jsx)(L,{search:e,currentPage:s,setCurrentPage:o})]})}}}]);
//# sourceMappingURL=883.eecc3bb1.chunk.js.map