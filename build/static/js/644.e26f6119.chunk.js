"use strict";(self.webpackChunktalk_call_chat_frontend=self.webpackChunktalk_call_chat_frontend||[]).push([[644],{92644:(e,t,s)=>{s.r(t),s.d(t,{default:()=>M});var r=s(65043),n=s(55978),o=s(70579);const a=()=>(0,o.jsx)("div",{className:"text-[var(--theme-color)] w-[38px] flex-shrink-0",children:(0,o.jsxs)("svg",{className:"w-full",viewBox:"0 0 513 513",fill:"currentColor",xmlns:"http://www.w3.org/2000/svg",children:[(0,o.jsx)("path",{d:"M256.025.05C117.67-2.678 3.184 107.038.025 245.383a240.703 240.703 0 0085.333 182.613v73.387c0 5.891 4.776 10.667 10.667 10.667a10.67 10.67 0 005.653-1.621l59.456-37.141a264.142 264.142 0 0094.891 17.429c138.355 2.728 252.841-106.988 256-245.333C508.866 107.038 394.38-2.678 256.025.05z"}),(0,o.jsx)("path",{d:"M330.518 131.099l-213.825 130.08c-7.387 4.494-5.74 15.711 2.656 17.97l72.009 19.374a9.88 9.88 0 007.703-1.094l32.882-20.003-10.113 37.136a9.88 9.88 0 001.083 7.704l38.561 63.826c4.488 7.427 15.726 5.936 18.003-2.425l65.764-241.49c2.337-8.582-7.092-15.72-14.723-11.078zM266.44 356.177l-24.415-40.411 15.544-57.074c2.336-8.581-7.093-15.719-14.723-11.078l-50.536 30.744-45.592-12.266L319.616 160.91 266.44 356.177z",fill:"#fff"})]})});var l=s(20870),i=s(32917),c=s(73216);const d=()=>{const e=(0,c.Zp)(),t=((0,r.useRef)(null),(0,r.useContext)(i.cy)),s=(0,r.useContext)(l.r),[a,d]=(0,r.useState)(null),[h,u]=(0,r.useState)(!1);return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"flex items-center gap-3 cursor-pointer ml-auto flex-shrink-0",children:[(0,o.jsx)("div",{onClick:()=>s.colorMode.setTheme(0===s.colorMode.theme?1:0),className:"w-[22px] h-[22px] text-[var(--settings-icon-color)] flex-shrink-0 hover:text-gray-400",children:0===s.colorMode.theme?(0,o.jsx)("svg",{className:"w-full fill-transparent transition-all duration-500",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:(0,o.jsx)("path",{d:"M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"})}):(0,o.jsxs)("svg",{className:"w-full fill-transparent transition-all duration-500",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"1.5",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"5"}),(0,o.jsx)("line",{x1:"12",y1:"1",x2:"12",y2:"3"}),(0,o.jsx)("line",{x1:"12",y1:"21",x2:"12",y2:"23"}),(0,o.jsx)("line",{x1:"4.22",y1:"4.22",x2:"5.64",y2:"5.64"}),(0,o.jsx)("line",{x1:"18.36",y1:"18.36",x2:"19.78",y2:"19.78"}),(0,o.jsx)("line",{x1:"1",y1:"12",x2:"3",y2:"12"}),(0,o.jsx)("line",{x1:"21",y1:"12",x2:"23",y2:"12"}),(0,o.jsx)("line",{x1:"4.22",y1:"19.78",x2:"5.64",y2:"18.36"}),(0,o.jsx)("line",{x1:"18.36",y1:"5.64",x2:"19.78",y2:"4.22"})]})}),(0,o.jsx)("div",{onClick:()=>{u(!h)},className:"text-[var(--settings-icon-color)] w-[22px] h-[22px] flex-shrink-0 hover:text-gray-400",children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"3"}),(0,o.jsx)("path",{d:"M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"})]})}),(0,o.jsx)("img",{className:"w-[40px] h-[40px] rounded-full border border-slate-300",src:"assets/avatar-default.svg",alt:"account-profile"})]}),h&&(0,o.jsx)("div",{className:"absolute top-16 right-5",children:(0,o.jsxs)(n.iK,{type:"slidedown",children:[1===t.user.role&&(0,o.jsx)("div",{className:"shadow-xl w-[200px] bg-white rounded-lg border border-slate-300",children:(0,o.jsxs)("div",{onClick:()=>e("/admin"),className:"cursor-pointer flex items-center justify-between hover:bg-neutral-200 px-4 py-2",children:[(0,o.jsx)("p",{className:"font-semibold text-[14px] ",children:"\u0410\u0434\u043c\u0438\u043d\u043a\u0430"}),(0,o.jsx)(n.In,{image:"command",color:"green"})]})}),(0,o.jsx)("div",{className:"shadow-xl w-[200px] bg-white rounded-lg border border-slate-300",children:(0,o.jsxs)("div",{onClick:()=>t.auth.signout(),className:"cursor-pointer flex items-center justify-between hover:bg-gray-300 px-4 py-2",children:[(0,o.jsx)("p",{className:"font-semibold text-[14px] ",children:"\u0412\u044b\u0445\u043e\u0434"}),(0,o.jsx)(n.In,{image:"log-out",color:"red"})]})})]})})]})},h=e=>{let{search:t,setSearch:s,setCurrentPage:r}=e;return(0,o.jsxs)("section",{className:"h-[12vh] border-b border-slate-300 flex sm:flex-row",children:[(0,o.jsx)("div",{className:"w-[15%] sm:w-1/4 overflow-hidden flex items-center px-4",children:(0,o.jsx)(a,{})}),(0,o.jsx)("div",{className:"w-[50%] sm:w-1/2 overflow-hidden flex items-center",children:(0,o.jsx)(n.DO,{value:t,onChange:e=>(e=>{r(1),s(e)})(e)})}),(0,o.jsx)("div",{className:"w-[35%] sm:w-1/4 overflow-hidden flex items-center justify-end px-4",children:(0,o.jsx)(d,{})})]})};var u=s(86213);const x=e=>{let{type:t,setType:s,setCurrentPage:n,setConversations:a}=e;const i=(0,r.useContext)(l.r),c=e=>{n(1),t!==e&&a([]),s(e)};return(0,o.jsxs)("div",{className:"w-full min-h-[6vh] flex items-center select-none border-b border-slate-300",children:[(0,o.jsx)("div",{onClick:()=>c(0),className:"\n          h-full w-1/2 flex items-center \n          justify-center cursor-pointer border-r border-slate-300 \n          ".concat(0===t&&0===i.colorMode.theme&&"bg-gray-300"," \n          ").concat(0===t&&1===i.colorMode.theme&&"bg-[#404d69]"," \n        "),children:(0,o.jsx)("p",{className:"\n            font-semibold text-[13px] \n            ".concat(0===i.colorMode.theme?"text-black":"text-white","\n          "),children:"\u0412\u0441\u0435"})}),(0,o.jsx)("div",{onClick:()=>c(1),className:"\n          h-full w-1/2 flex items-center \n          justify-center cursor-pointer\n          ".concat(1===t&&0===i.colorMode.theme&&"bg-gray-300"," \n          ").concat(1===t&&1===i.colorMode.theme&&"bg-[#404d69]"," \n        "),children:(0,o.jsx)("p",{className:"\n            font-semibold text-[13px] \n            ".concat(0===i.colorMode.theme?"text-black":"text-white","\n          "),children:"\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u044b\u0435"})})]})};var m=s(24033);const v=e=>{const{conversations:t,activeConversation:s,handleChatClick:n,setConversations:a,setCurrentPage:i,currentPage:c}=e,d=(0,r.useRef)(null),h=(0,r.useContext)(l.r),{raiseConversation:u}=(0,m.c)();(0,r.useEffect)((()=>{const e=()=>{if(d.current){const{scrollHeight:e,scrollTop:t,clientHeight:s}=d.current;t+s+1>=e&&i((e=>e+1))}},t=d.current;return t&&t.addEventListener("scroll",e),()=>{t&&t.removeEventListener("scroll",e)}}),[c]),(0,r.useEffect)((()=>{u&&x()}),[u]);const x=()=>{a((e=>{const t=e.findIndex((e=>e.customer_id===u.customer_id));if(-1!==t){const s=e[t];return s.counter=(s.counter||0)+(u.counter||0),e.splice(t,1),[s,...e]}return[{...u,counter:u.counter||0},...e]}))};return(0,o.jsx)("div",{ref:d,className:"flex-grow overflow-y-auto",children:t.length>0&&t.map(((e,t)=>{var r;return(0,o.jsxs)("div",{onClick:()=>n(e),className:"relative select-none\n            cursor-pointer flex items-center gap-2 px-5 py-3 \n            ".concat(0===h.colorMode.theme&&"hover:bg-gray-300","\n            ").concat(1===h.colorMode.theme&&"hover:bg-[#2d3f65]","\n            ").concat(s.customer_id===e.customer_id&&0===h.colorMode.theme&&"bg-gray-300","\n            ").concat(s.customer_id===e.customer_id&&1===h.colorMode.theme&&"bg-[#2d3f65]","\n          "),children:[s.customer_id===e.customer_id&&(0,o.jsx)("div",{className:"absolute left-0 h-full w-1 bg-[#0086FF]"}),(0,o.jsx)("div",{className:"relative inline-block",children:(0,o.jsx)("img",{src:null!==(r=e.customer_photo)&&void 0!==r?r:"assets/avatar-default.svg",className:"border border-slate-300 rounded-full w-10 h-10"})}),(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsx)("p",{className:"font-semibold text-[15px] ".concat(0===h.colorMode.theme?"text-black":"text-white"),children:e.leadvertex_id}),(0,o.jsxs)("div",{className:"flex items-center overflow-hidden gap-1",children:[(0,o.jsx)("p",{className:"whitespace-nowrap overflow-hidden overflow-ellipsis text-[var(--msg-message)] text-[13px]",children:e.customer_good}),(0,o.jsxs)("p",{className:"text-[14px] text-[var(--msg-date)] ml-3 relative",children:[(0,o.jsx)("span",{className:"absolute top-0 left-[-10px]",children:"\u2022"}),e.lastMessageTime]})]}),(null===e||void 0===e?void 0:e.counter)&&(0,o.jsx)("div",{className:"absolute top-2 right-2 overflow-hidden",children:(0,o.jsx)("p",{className:"flex items-center justify-center text-[12px] w-5 h-5 bg-red-500 rounded-full text-white",children:(null===e||void 0===e?void 0:e.counter)>100?"99+":null===e||void 0===e?void 0:e.counter})})]})]},e.customer_id)}))})},p=e=>{let{setConversations:t}=e;const s=(0,r.useContext)(i.cy),n=(0,r.useContext)(l.r),[a,c]=(0,r.useState)(""),[d,h]=(0,r.useState)(null);return(0,o.jsxs)("div",{className:"flex flex-col gap-6 h-[25vh]",children:[(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("p",{className:"w-32 font-semibold text-lg",children:"LeadVertext_Id:"}),(0,o.jsx)("input",{type:"text",value:d,onChange:e=>h(e.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",className:"pl-[16px] outline-none h-8 w-full \n            bg-transparent text-body-color bg-no-repeat \n            bg-[length:16px] bg-[25px_48%] font-body-font \n            font-semibold text-[15px] placeholder-input-chat-color\n            border border-slate-300 rounded-lg\n            ".concat(0===n.colorMode.theme?"text-black":"text-white","\n          ")})]}),(0,o.jsxs)("div",{className:"flex items-center gap-3",children:[(0,o.jsx)("p",{className:"w-32 font-semibold text-lg",children:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435:"}),(0,o.jsx)("input",{type:"text",value:a,onChange:e=>c(e.target.value),placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",className:"pl-[16px] outline-none h-8 w-full \n            bg-transparent text-body-color bg-no-repeat \n            bg-[length:16px] bg-[25px_48%] font-body-font \n            font-semibold text-[15px] placeholder-input-chat-color\n            border border-slate-300 rounded-lg\n            ".concat(0===n.colorMode.theme?"text-black":"text-white","\n          ")})]}),(0,o.jsx)("button",{onClick:async()=>{a&&d?await(0,u.A)({method:"POST",url:"v1/send_first_message",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.user.token)},data:{message:a,leadvertex_id:d,sender:s.user.manager_name}}).then((e=>{t((t=>[e.data.new_customer,...t])),n.modal.hide(),n.notification.show("\u0423\u0441\u043f\u0435\u0448\u043d\u043e!","success")})).catch((e=>n.notification.show(e.response.data.detail,"error"))):n.notification.show("\u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u0432\u0441\u0435 \u043f\u043e\u043b\u044f","error")},className:"ml-auto max-w-[20vh] mt-4 bg-white p-2 \n          rounded-lg hover:bg-blue-100 border border-slate-300\n        ",children:"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c"})]})},f=e=>{let{setConversations:t}=e;const s=(0,r.useContext)(l.r);return(0,o.jsx)("div",{onClick:()=>{s.modal.show({title:"\u041d\u0430\u043f\u0438\u0441\u0430\u0442\u044c \u043f\u0435\u0440\u0432\u044b\u043c",children:(0,o.jsx)(p,{setConversations:t})})},className:"fixed bottom-3 left-3 bg-[#0086FF] w-8 h-8 rounded-full flex items-center justify-center cursor-pointer shadow-xl",children:(0,o.jsx)(n.In,{image:"plus",color:"white",size:28})})},g=e=>{const{activeConversation:t,setActiveConversation:s,type:r,setType:n,conversations:a,setConversations:l,fetchConversation:i,setCurrentPage:c,currentPage:d,setAudio:h}=e,{raisedConversations:u,setRaisedConversations:p}=(0,m.c)();return(0,o.jsxs)("div",{className:"flex flex-col h-full w-full sm:w-1/4 overflow-y-auto border-r border-slate-300 relative",children:[(0,o.jsx)(x,{type:r,setType:n,setCurrentPage:c,setConversations:l}),(0,o.jsx)(v,{conversations:a,activeConversation:t,handleChatClick:e=>{if(u&&u.length>0){l((t=>t.map((t=>u.find((e=>e.customer_id===t.customer_id))&&t.customer_id===e.customer_id?{...t,counter:null}:t))));const t=u.filter((t=>t.customer_id!==e.customer_id));p(t)}s(e),i(e.customer_id),h(null)},setConversations:l,currentPage:d,setCurrentPage:c}),(0,o.jsx)(f,{setConversations:l})]})},w=e=>{let{fetchConversations:t,isFavorite:s,title:n,activeConversation:a}=e;const c=(0,r.useContext)(i.cy),d=(0,r.useContext)(l.r);return(0,o.jsxs)("div",{className:"flex items-center justify-between px-6 py-6 border-b border-slate-300",children:[(0,o.jsx)("div",{className:"text-[18px] font-semibold ".concat(0===d.colorMode.theme?"text-black":"text-white"),children:n}),(0,o.jsx)("div",{onClick:()=>(async()=>{await(0,u.A)({method:"POST",url:"v1/add_favorite",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(c.user.token)},params:{customer_id:a.customer_id}}).then((()=>t())).catch((e=>d.notification.show(e.response.data.detail,"error")))})(),children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"".concat(s?"red":"none"),stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:(0,o.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})})]})},j=e=>{let{conversation:t,setConversation:s,activeConversation:a}=e;const l=(0,r.useRef)(null),{newMessage:i}=(0,m.c)();(0,r.useEffect)((()=>{d()}),[t]),(0,r.useEffect)((()=>{i&&c(i)}),[i]);const c=e=>{if(a.customer_phone===e.chat_phone){const r=[...t];r.push(e),s(r)}},d=()=>{l.current&&l.current.scrollIntoView({behavior:"smooth"})};return(0,o.jsxs)("div",{className:"w-full h-full flex flex-col gap-3 overflow-y-auto px-6 py-6",children:[(null===t||void 0===t?void 0:t.length)>0&&(null===t||void 0===t?void 0:t.map((e=>{var t;return(0,o.jsxs)("div",{className:"flex items-end gap-2 ".concat(e.message_incoming?"flex-row":"flex-row-reverse"),children:[(0,o.jsx)("img",{src:null!==(t=e.sender_avatar)&&void 0!==t?t:"assets/avatar-default.svg",alt:"avatar",className:"h-10 w-10 rounded-full border border-slate-300"}),(0,o.jsxs)("div",{className:"\n              inline-block min-w-[10px] max-w-[50%]\n              ".concat(e.message_incoming&&!e.attachment_url&&"rounded-r-xl rounded-tl-xl bg-[#fff] text-black px-3 py-3","\n              ").concat(!e.message_incoming&&!e.attachment_url&&"rounded-l-xl rounded-tr-xl bg-[#0086FF] text-white px-3 py-3","\n            "),children:["message"===e.message_type&&(0,o.jsx)(o.Fragment,{children:e.message_text}),"photo"===e.message_type&&(0,o.jsx)("img",{src:e.attachment_url?e.message_incoming?e.attachment_url:"http://31.128.41.42:8000/v1/"+e.attachment_url:"assets/no-image.jpg",alt:"message_".concat(e.id),className:"w-fit min-h-16 max-h-40 rounded-lg"}),("doc"===e.message_type||"audio"===e.message_type)&&(0,o.jsx)(n.$G,{src:e.attachment_url})]})]},e.id)}))),(0,o.jsx)("div",{ref:l})]})};var b=s(51842),y=s(70410);s(61011);const C=e=>{let{file:t,setFile:s,message:n,setMessage:a,audio:i,setAudio:c,setRAudio:d,handleSendMessage:h}=e;const u=(0,r.useContext)(l.r),x=(0,r.useRef)(null),m=(0,r.useRef)([]),v=(0,r.useRef)(null),p=(0,r.useRef)(null),f=(0,r.useRef)(null),g=(0,r.useRef)(null),w=(0,r.useRef)(null),[j,C]=(0,r.useState)("default"),[k,N]=(0,r.useState)(0),[_,M]=(0,r.useState)(!1),A=()=>{s(null),navigator.mediaDevices.getUserMedia({audio:!0}).then((e=>{const t=new(window.AudioContext||window.webkitAudioContext);v.current=t;const s=t.createMediaStreamSource(e),r=t.createAnalyser();r.fftSize=256,f.current=r;const n=r.frequencyBinCount,o=new Uint8Array(n);p.current=o,s.connect(r);const a=new MediaRecorder(e);g.current=a,a.start(),a.ondataavailable=e=>{m.current.push(e.data)},a.onstop=async()=>{const e=new Blob(m.current,{type:"audio/mp3"}),s=URL.createObjectURL(e);c(s),d(e),m.current=[],t.close(),cancelAnimationFrame(w.current)},C("recording"),z()})).catch((e=>{console.error("\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0437\u0430\u043f\u0438\u0441\u0438 \u0430\u0443\u0434\u0438\u043e:",e)}))},L=()=>{C("default")},z=()=>{if(f.current&&p.current){f.current.getByteFrequencyData(p.current);const e=Math.max(...p.current);N(e),w.current=requestAnimationFrame(z)}};return(0,o.jsxs)("div",{className:"flex items-center gap-2 border-t border-slate-300",children:["default"===j&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("div",{className:"w-[5%] flex items-center justify-center pl-3 py-6",children:[(0,o.jsx)("div",{onClick:()=>x.current.click(),children:(0,o.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:(0,o.jsx)("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48"})})}),(0,o.jsx)("input",{type:"file",ref:x,style:{display:"none"},onChange:e=>{c(null),d(null);const t=e.target.files[0];a(""),t&&s(t)}})]}),(0,o.jsxs)("div",{className:"w-[85%] relative flex items-center h-full",children:[t&&(0,o.jsx)("div",{className:"absolute top-0",children:(0,o.jsxs)("div",{className:"flex items-center gap-1",children:[(0,o.jsx)("p",{className:"\n                    text-[10px]\n                    ".concat(0===u.colorMode.theme?"text-black":"text-white","\n                  "),children:t.name}),(0,o.jsx)("svg",{viewBox:"0 0 1024 1024",fill:"currentColor",height:"0.7em",width:"0.7em",cursor:"pointer",onClick:()=>s(null),children:(0,o.jsx)("path",{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"})})]})}),(0,o.jsx)("input",{type:"text",className:"bg-[#EBEBEC] w-full outline-none h-10 rounded-md pl-3 border border-slate-300",placeholder:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435...",value:n,onChange:e=>{e.preventDefault(),a(e.target.value)},onKeyDown:e=>{"Enter"===e.key&&h()},disabled:!!t}),(0,o.jsx)("div",{className:"absolute right-0 pr-3",children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",onClick:h,children:[(0,o.jsx)("path",{d:"M22 2L11 13"}),(0,o.jsx)("path",{d:"M22 2L15 22 11 13 2 9l20-7z"})]})})]}),(0,o.jsxs)("div",{className:"w-[10%] flex items-center gap-2 py-6",children:[(0,o.jsx)("div",{onClick:()=>A(),children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:[(0,o.jsx)("path",{d:"M12 1a3 3 0 0 1 3 3v10a3 3 0 0 1-6 0V4a3 3 0 0 1 3-3z"}),(0,o.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,o.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,o.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,o.jsx)("div",{onClick:()=>M(!_),children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"w-6 h-6 text-gray-300 cursor-pointer hover:text-gray-400 hover:font-bold",children:[(0,o.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,o.jsx)("path",{d:"M8 14s1.5 2 4 2 4-2 4-2M9 9h.01M15 9h.01"})]})})]}),_&&(0,o.jsx)("div",{className:"absolute bottom-0 sm:bottom-20 sm:right-20",children:(0,o.jsx)(b.A,{data:y,previewPosition:"none",onEmojiSelect:e=>{a(n+e.native),M(!_)}})})]}),"recording"===j&&(0,o.jsxs)("div",{className:"flex items-center justify-center gap-3 w-full",children:[(0,o.jsx)("div",{className:"w-[5%] flex items-center justify-center pl-3 py-6",children:(0,o.jsx)("div",{onClick:()=>L(),children:(0,o.jsx)("svg",{fill:"red",viewBox:"0 0 16 16",height:"1.2em",width:"1.2em",cursor:"pointer",className:"hover:bg-slate-300 hover:rounded-xl",children:(0,o.jsx)("path",{d:"M6.5 1h3a.5.5 0 01.5.5v1H6v-1a.5.5 0 01.5-.5zM11 2.5v-1A1.5 1.5 0 009.5 0h-3A1.5 1.5 0 005 1.5v1H2.506a.58.58 0 00-.01 0H1.5a.5.5 0 000 1h.538l.853 10.66A2 2 0 004.885 16h6.23a2 2 0 001.994-1.84l.853-10.66h.538a.5.5 0 000-1h-.995a.59.59 0 00-.01 0H11zm1.958 1l-.846 10.58a1 1 0 01-.997.92h-6.23a1 1 0 01-.997-.92L3.042 3.5h9.916zm-7.487 1a.5.5 0 01.528.47l.5 8.5a.5.5 0 01-.998.06L5 5.03a.5.5 0 01.47-.53zm5.058 0a.5.5 0 01.47.53l-.5 8.5a.5.5 0 11-.998-.06l.5-8.5a.5.5 0 01.528-.47zM8 4.5a.5.5 0 01.5.5v8.5a.5.5 0 01-1 0V5a.5.5 0 01.5-.5z"})})})}),(0,o.jsx)("div",{className:"w-[85%] relative flex items-center h-full",children:(0,o.jsx)("div",{style:{width:"100%",height:"10px",background:"gray",position:"relative",overflow:"hidden"},children:(0,o.jsx)("div",{style:{width:"".concat(k,"%"),height:"100%",background:"red",position:"absolute",left:0,transition:"width 0.1s"}})})}),(0,o.jsxs)("div",{className:"w-[10%] flex items-center gap-2 py-6",children:[(0,o.jsx)("div",{onClick:()=>{g.current&&(g.current.stop(),C("before"))},children:(0,o.jsx)("svg",{viewBox:"0 0 1024 1024",fill:0===u.colorMode.theme?"black":"white",height:"1.4em",width:"1.4em",cursor:"pointer",className:"hover:bg-gray-300 hover:rounded-xl",children:(0,o.jsx)("path",{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"})})}),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:0===u.colorMode.theme?"black":"white",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 cursor-pointer hover:bg-gray-300 hover:rounded-md",onClick:h,children:[(0,o.jsx)("path",{d:"M22 2L11 13"}),(0,o.jsx)("path",{d:"M22 2L15 22 11 13 2 9l20-7z"})]})]})]}),"before"===j&&(0,o.jsxs)("div",{className:"flex items-center justify-center gap-3 w-full h-full",children:[(0,o.jsx)("div",{className:"w-[5%] flex items-center justify-center pl-3 py-6",children:(0,o.jsx)("div",{onClick:()=>L(),children:(0,o.jsx)("svg",{fill:"red",viewBox:"0 0 16 16",height:"1.2em",width:"1.2em",cursor:"pointer",className:"hover:bg-slate-300 hover:rounded-xl",children:(0,o.jsx)("path",{d:"M6.5 1h3a.5.5 0 01.5.5v1H6v-1a.5.5 0 01.5-.5zM11 2.5v-1A1.5 1.5 0 009.5 0h-3A1.5 1.5 0 005 1.5v1H2.506a.58.58 0 00-.01 0H1.5a.5.5 0 000 1h.538l.853 10.66A2 2 0 004.885 16h6.23a2 2 0 001.994-1.84l.853-10.66h.538a.5.5 0 000-1h-.995a.59.59 0 00-.01 0H11zm1.958 1l-.846 10.58a1 1 0 01-.997.92h-6.23a1 1 0 01-.997-.92L3.042 3.5h9.916zm-7.487 1a.5.5 0 01.528.47l.5 8.5a.5.5 0 01-.998.06L5 5.03a.5.5 0 01.47-.53zm5.058 0a.5.5 0 01.47.53l-.5 8.5a.5.5 0 11-.998-.06l.5-8.5a.5.5 0 01.528-.47zM8 4.5a.5.5 0 01.5.5v8.5a.5.5 0 01-1 0V5a.5.5 0 01.5-.5z"})})})}),(0,o.jsx)("div",{className:"w-[85%] flex items-center h-full",children:i&&(0,o.jsx)("audio",{controls:!0,src:i,className:"w-full"})}),(0,o.jsxs)("div",{className:"w-[10%] flex items-center gap-2 py-6",children:[(0,o.jsx)("div",{onClick:()=>(c(null),d(null),A(),void C("recording")),children:(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:0===u.colorMode.theme?"black":"white",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 text-gray-300 cursor-pointer hover:bg-gray-300 hover:rounded-lg hover:font-bold",children:[(0,o.jsx)("path",{d:"M12 1a3 3 0 0 1 3 3v10a3 3 0 0 1-6 0V4a3 3 0 0 1 3-3z"}),(0,o.jsx)("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),(0,o.jsx)("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),(0,o.jsx)("line",{x1:"8",y1:"23",x2:"16",y2:"23"})]})}),(0,o.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:0===u.colorMode.theme?"black":"white",strokeWidth:"1.2",strokeLinecap:"round",strokeLinejoin:"round",className:"w-5 h-5 cursor-pointer hover:bg-gray-300 hover:rounded-md",onClick:h,children:[(0,o.jsx)("path",{d:"M22 2L11 13"}),(0,o.jsx)("path",{d:"M22 2L15 22 11 13 2 9l20-7z"})]})]})]})]})},k=e=>{let{conversation:t,setConversation:s,fetchConversations:r,activeConversation:n,message:a,setMessage:l,file:i,setFile:c,audio:d,setAudio:h,setRAudio:u,handleSendMessage:x}=e;return(0,o.jsx)("div",{className:"flex flex-col justify-between sm:w-1/2 overflow-y-auto",children:n.customer_id&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(w,{isFavorite:t.isFavorite,activeConversation:n,title:n.customer_good,fetchConversations:r}),(0,o.jsx)(j,{conversation:t,setConversation:s,activeConversation:n}),(0,o.jsx)(C,{file:i,setFile:c,message:a,setMessage:l,audio:d,setAudio:h,setRAudio:u,handleSendMessage:x})]})})},N=e=>{var t;let{activeConversation:s,audio:n,setAudio:a,handleSendMessage:i}=e;(0,r.useContext)(l.r);return(0,o.jsx)("div",{className:"h-full w-full sm:w-1/4 border-l border-slate-300 overflow-y-auto",children:s.customer_id&&(0,o.jsx)("div",{className:"flex flex-col gap-2 items-center py-6",children:(0,o.jsx)("img",{src:null!==(t=s.avatar)&&void 0!==t?t:"assets/avatar-default.svg",alt:"avatar",className:"h-16 w-16 rounded-full border border-slate-300"})})})},_=e=>{let{search:t,currentPage:s,setCurrentPage:n}=e;const a=(0,r.useContext)(i.cy),c=(0,r.useContext)(l.r),[d,h]=(0,r.useState)({customer_id:null,customer_good:"",customer_phone:"",leadvertex_id:null}),[x,m]=(0,r.useState)([]),[v,p]=(0,r.useState)(0),[f,w]=(0,r.useState)([]),[j,b]=(0,r.useState)(""),[y,C]=(0,r.useState)(null),[_,M]=(0,r.useState)(null),[A,L]=(0,r.useState)(null);(0,r.useEffect)((()=>{z()}),[t,v,s]);const z=async()=>{const e={manager_id:a.user.id,customers_type:v,page:s,limit:20};""!==t&&(e.search=t),await(0,u.A)({method:"GET",url:"v1/get_conversations",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.user.token)},params:{...e}}).then((e=>{w(""!==t?[...e.data.customers]:t=>[...t,...e.data.customers])})).catch((e=>{c.notification.show(e.response.data.detail,"error")}))},S=async e=>{var t;if(!B())return;const s=null===(t=x.reverse().find((e=>!0===e.message_incoming&&e.lead_id)))||void 0===t?void 0:t.lead_id;if(!s)return;const r=new FormData;r.append("message",j),r.append("sender",a.user.manager_name),r.append("customer_phone",d.customer_phone),r.append("lead_id",s),A&&r.append("files",A),y&&r.append("files",y),await(0,u.A)({method:"POST",url:"/v1/send_message",headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(a.user.token)},data:r}).then((e=>{const t=[...x];t.push(e.data.message),m(t),b(""),C(null),M(null),L(null)})).catch((e=>{c.notification.show(e.response.data.detail,"error")}))},B=()=>null!==y||null!==A||0!==j.length||(c.notification.show("\u041f\u0443\u0441\u0442\u043e\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435","error"),!1);return(0,o.jsxs)("div",{className:"flex flex-col sm:flex-row h-[88vh]",children:[(0,o.jsx)(g,{setCurrentPage:n,fetchConversation:async e=>{await(0,u.A)({method:"GET",url:"v1/get_chat_history/".concat(e),headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.user.token)}}).then((e=>m(e.data.messages))).catch((e=>c.notification.show(e.response.data.detail,"error")))},type:v,setType:p,conversations:f,setConversations:w,activeConversation:d,setActiveConversation:h,setAudio:M}),(0,o.jsx)(k,{conversation:x,setConversation:m,fetchConversations:z,activeConversation:d,message:j,setMessage:b,file:y,setFile:C,audio:_,setAudio:M,setRAudio:L,handleSendMessage:S}),(0,o.jsx)(N,{activeConversation:d,audio:_,setAudio:M,handleSendMessage:S})]})};function M(){const[e,t]=(0,r.useState)(""),[s,n]=(0,r.useState)(1);return(0,o.jsxs)("div",{className:"flex flex-col w-full min-h-[100vh]",children:[(0,o.jsx)(h,{search:e,setSearch:t,setCurrentPage:n}),(0,o.jsx)(_,{search:e,currentPage:s,setCurrentPage:n})]})}}}]);
//# sourceMappingURL=644.e26f6119.chunk.js.map